<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <link href="/Public/css/bootstrap.min.css" rel="stylesheet">
    <script src="/Public/js/jquery-1.10.2.min.js"></script>
    <script src="/Public/js/vue.min.js"></script>
    <script src="/Public/js/layer.js"></script>
    <script src="/Public/js/dialog.js"></script>
    <script src="/Public/js/bootstrap.min.js"></script>
    <script src="/Public/js/ajaxfileupload.js"> </script>
    <script src="/kindeditor/kindeditor-all-min.js"> </script>
</head>
<body>
	

<form class="form-horizontal" id="form" name="form">
    <ul id="myTab" class="nav nav-tabs">
      <!--   <li class="active">
            <a href="#home" data-toggle="tab">基本设置</a>
        </li>
        <li><a href="#senior" data-toggle="tab">高级设置</a></li> -->
    </ul>
    <div id="myTabContent" class="tab-content">
        <div class="tab-pane fade in active" id="home">
            <div class="form-group">
                <label class="col-md-2 control-label" style="line-height: 100px;">图片:</label>
                <div class="col-md-4">
                    <input type="text" class="form-control" v-model="form.url" style="margin-top: 40px">
                </div>
                <div class="col-md-1">
                    <button type="button" class="btn btn-primary pic" style="margin-top: 40px;display:none;" onclick="$('#tbpic').click();" >点击上传</button>
                </div>
                <div class="col-md-2">
                    <img id="pic1" onclick="$('#tbpic').click();" src="{{form.url}}" style="width: 98px;height: 98px;border: 1px solid #afafaf;cursor:pointer;">
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label">排列顺序:</label>
                <div class="col-md-4">
                    <input type="text" class="form-control" v-model="form.sort">
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label">外部链接:</label>
                <div class="col-md-4">
                    <input type="text" class="form-control" v-model="form.link">
                </div>
            </div>
            <div class="form-group">
                <div class="col-md-offset-4 col-md-2">
                    <button v-on:click="post" type="button" class="btn btn-default">确定</button>
                </div>
                <div class="col-md-offset-0 col-md-2">
                    <button type="button" class="btn btn-default">重置</button>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="senior">
          
            <div class="form-group">
                <label class="col-md-2 control-label">列表页显示数量:</span></label>
                <div style="margin-top: 7px;" class="col-md-4">
                    <input type="text" class="form-control" v-model="form.list_num">
                </div>
                <div style="margin-top: 7px;" class="col-md-4">
                    <span style="color: #afafaf">仅对列表页起作用</span>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label">列表页模板:</span></label>
                <div style="margin-top: 7px;" class="col-md-4">
                    <input type="text" class="form-control" v-model="tpllistCurrent">
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label">内容页模板:</span></label>
                <div style="margin-top: 7px;" class="col-md-4">
                    <input type="text" class="form-control" v-model="tplContentCurrent">
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label" style="line-height: 100px;">栏目图片1:</label>
                <div class="col-md-4">
                    <input type="text" class="form-control" v-model="form.pic1" style="margin-top: 40px">
                </div>
                <div class="col-md-1">
                    <button type="button" class="btn btn-primary pic" style="margin-top: 40px;display:none;" onclick="$('#tbpic').click();" >点击上传</button>
                </div>
                <div class="col-md-2">
                    <img id="pic1" onclick="init.picItem='pic1';$('#tbpic').click();" src="/Public/images/no_pc.gif" style="width: 98px;height: 98px;border: 1px solid #afafaf;cursor:pointer;">
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label" style="line-height: 100px;">栏目图片2:</label>
                <div class="col-md-4">
                    <input type="text" class="form-control" v-model="form.pic2" style="margin-top: 40px">
                </div>
                <div class="col-md-1">
                    <button type="button" class="btn btn-primary pic" style="margin-top: 40px;display:none;" onclick="$('#tbpic').click();" >点击上传</button>
                </div>
                <div class="col-md-2">
                    <img id="pic2" onclick="init.picItem='pic2';$('#tbpic').click();" src="/Public/images/no_pc.gif" style="width: 98px;height: 98px;border: 1px solid #afafaf;cursor:pointer;">
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label" style="line-height: 100px;">栏目图片3:</label>
                <div class="col-md-4">
                    <input type="text" class="form-control" v-model="form.pic3" style="margin-top: 40px">
                </div>
                <div class="col-md-1">
                    <button type="button" class="btn btn-primary pic" style="margin-top: 40px;display:none;" onclick="$('#tbpic').click();" >点击上传</button>
                </div>
                <div class="col-md-2">
                    <img id="pic3" onclick="init.picItem='pic3';$('#tbpic').click();" src="/Public/images/no_pc.gif" style="width: 98px;height: 98px;border: 1px solid #afafaf;cursor:pointer;">
                </div>
            </div>
            <input id="tbpic" name="tbpic" type="file" class="" style="margin-top: 40px;display: none;" onchange="up_tbpic()">
          <!--   <div class="form-group" style="height: 100px;">
                <label class="col-md-2 control-label" for="exampleInputFile" style="line-height: 100px;">栏目图片1:</label>
                <div class="col-md-4" style="margin-top: 35px;">
                    <input class="col-md-4 form-control" type="text" v-model="form.pic1">
                </div>
                <div class="col-md-2"  style="margin-top: 35px;">
                    <input type="file" id="exampleInputFile1">
                </div>
                <div class="col-md-4">
                    <img src="./content/images/no_pc.gif">
                </div>
            </div>
            <div class="form-group" style="height: 100px;">
                <label class="col-md-2 control-label" for="exampleInputFile" style="line-height: 100px;">栏目图片2:</label>
                <div class="col-md-4" style="margin-top: 35px;">
                    <input class="col-md-4 form-control" type="text" v-model="form.pic1">
                </div>
                <div class="col-md-2"  style="margin-top: 35px;">
                    <input type="file" id="exampleInputFile2">
                </div>
                <div class="col-md-4">
                    <img src="./content/images/no_pc.gif">
                </div>
            </div> -->
            <div class="form-group ">
                <label class="col-md-2 control-label" for="exampleInputFile" style="line-height: 100px;">栏目内容:</label>
                <div class="col-md-10">
                    <textarea id="editor_id" name="content" style="width:670px;height:500px;"></textarea>
                </div>
            </div>
        </div>
    </div>
    <script>  
    	var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
        var form=new Vue({
            el:"#form",
            data:{
                form:{$form},
            },
            methods:{
                post:function(event){
                    if(form.form.url==""){
                        dialog.error("请上传图片");
                        return ;
                    }
                    if(form.form.sort==""){
                        dialog.error("栏目排序不能为空");
                        return ;
                    }
                    $.post("?m=Admin&c=Banner&a=doUpdateImg",{form:form.form},function(res){
                        if(res.status==1){
                            dialog.successFun(res.message,function() {
                                parent.list.updateImgList();
                                parent.layer.close(index);
                            })
                        }
                        else{
                            dialog.error(res.message);
                        }
                    },"json");
                }
            }
        });

        //异步上传图片并预览
        function up_tbpic(){
            $.ajaxFileUpload(
            {
                url: '/index.php?m=Admin&c=List&a=doUpload&tbpic='+form.form.url, //用于文件上传的服务器端请求地址
                secureuri: false, //是否需要安全协议，一般设置为false
                fileElementId: 'tbpic', //文件上传域的ID
                dataType: 'json', //返回值类型 一般设置为json
                success: function (data, status)  //服务器成功响应处理函数
                {
                    $("#pic1").attr("src",data.responseText);
                    form.form.url=data.responseText;
                },
                error: function (data, status, e)//服务器响应失败处理函数
                {
                    $("#pic1").attr("src",data.responseText);
                    form.form.url=data.responseText;
                }
            });
        };
    </script>
</form>
</body>
</html>